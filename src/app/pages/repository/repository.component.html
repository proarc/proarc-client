@if (loading) {
  <mat-progress-bar mode="indeterminate" class="app-progress-bar"></mat-progress-bar>
}
@if (!loading) {
  <div class="app-fxLayout app-column app-fill app-editor-wrapper">
    <div class="app-fxLayout app-row app-center-v app-gap-4 app-breadcrumbsbar">
      <div class="app-fxLayout app-row app-center-v app-inner app-view-border-right app-pr-4">
        <a routerLink="/"><mat-icon>home</mat-icon></a>
        <span class="app-separator">/</span>
        @for(p of path; let last = $last; let l = $count; let idx = $index; track $index;) {
          @if (!last) {
            <a (click)="goToObjectByPid(p.pid)" [matTooltip]="'model.' + p.model | translate" class="app-text-cutter" [matTooltip]="p.label">{{ p.label }}</a>
          }
          @if (idx < l - 2) {
            <span class="app-separator">/</span>
          }
        }
        @if (path.length === 1) {
          <a (click)="selectLast()" class="app-text-cutter" [matTooltip]="layout.item.label" [matTooltipPosition]="'above'">{{ layout.item.label }}</a>
        }
      </div>
      <div class="app-fxLayout app-row app-center-v app-inner">
        @if (path.length === 1) {
          <div class="app-model">{{ 'model.' + layout.item.model | translate }}</div>
        }
        @if (path.length > 1) {
          <div class="app-model app-cursor-pointer" (click)="selectLast()">{{ 'model.' + layout.item.model | translate }} - {{ layout.item.label }}</div>
        }
      </div>
      <div class="app-fxFlex app-fxLayout app-row app-center-v app-inner">
        <button mat-icon-button [matMenuTriggerFor]="menuMore" [matTooltip]="'button.more' | translate">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menuMore="matMenu">
          <button mat-menu-item (click)="onExport()" >{{ 'button.export' | translate }}</button>
          <button mat-menu-item (click)="onUrnnbn()" >URN:NBN</button>
          @if (canCopy()) {
            <button mat-menu-item (click)="onCopyItem()">{{ 'button.copy' | translate }}</button>
          }
          <!-- <button mat-menu-item *ngIf="auth.user.changeModelFunction || auth.isSuperAdmin()" (click)="showConvertDialog()">{{ 'button.convertPages' | translate }}</button> -->
          @if (auth.user.czidloFunction || auth.isSuperAdmin()) {
            <button mat-menu-item (click)="czidlo()">{{ 'button.czidloFunction' | translate }}</button>
          }
          @if (config.updateInSource && (auth.user.importToCatalogFunction || auth.isSuperAdmin()) && canUpdateInSource()) {
            <button mat-menu-item (click)="updateInSource()">{{ 'button.updateInSource' | translate }}</button>
          }
          <button mat-menu-item (click)="validateObject()">{{ 'button.validateObject' | translate }}</button>
        </mat-menu>
        @if (batchInfo) {
          <button mat-icon-button color="primary" (click)="onShowLog();" [matTooltip]="'button.viewErrorDetail' | translate" matTooltipPosition="below" class="app-icon-button">
            <mat-icon>error_outline</mat-icon>
          </button>
        }
      </div>
      <div class="app-fxLayout app-row app-center-v app-inner">
        <button matTooltip="{{ 'editor.toolbar.nav_up' | translate }}" (click)="goToObject(layout.parent)" [disabled]="!layout.parent" mat-icon-button>
          <mat-icon>keyboard_arrow_up</mat-icon>
        </button>
        <button matTooltip="{{ 'editor.toolbar.nav_down' | translate }}" (click)="goToFirst()" [disabled]="layout.items().length === 0" mat-icon-button>
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
        <button matTooltip="{{ 'editor.toolbar.nav_prev' | translate }}" (click)="goToObject(layout.previousItem)" [disabled]="!layout.previousItem" mat-icon-button>
          <mat-icon>keyboard_arrow_left</mat-icon>
        </button>
        <button matTooltip="{{ 'editor.toolbar.nav_next' | translate }}" (click)="goToObject(layout.nextItem)" [disabled]="!layout.nextItem" mat-icon-button>
          <mat-icon>keyboard_arrow_right</mat-icon>
        </button>
        <button matTooltip="{{ 'navbar.layout' | translate }}" (click)="showLayoutAdmin()" mat-icon-button>
          <mat-icon>dashboard</mat-icon>
        </button>
      </div>
    </div>
    <div class="app-fxFlex app-oh app-content-wrapper" >
      <div class="app-border-wrapper app-h-100">
        @if (settings.repositoryLayout) {
          <as-split direction="horizontal" [disabled]="settings.repositoryLayout.disabled"  (dragEnd)="onDragEnd(-1, $event)">
            @for(column of settings.repositoryLayout.columns; let icol = $index; track $index;) {
              @if (column.visible) {
                <as-split-area [size]="column.size">
                  <as-split direction="vertical" [disabled]="settings.repositoryLayout.disabled" (dragEnd)="onDragEnd(icol, $event)">
                    @for(row of column.rows; let irow=$index; track $index;) {
                      @if (row.visible) {
                        <as-split-area  [size]="row.size" [class.app-disabled]="!row.canEdit">
                          <app-panel [panel]="row" [rootItem]="layout.rootItem" [lastSelectedItem]="layout.lastSelectedItem()" [numOfSelected]="layout.getNumOfSelected()" ></app-panel>
                        </as-split-area>
                      }
                    }
                  </as-split>
                </as-split-area>
              }
            }
          </as-split>
        }
      </div>
    </div>
  </div>
}
