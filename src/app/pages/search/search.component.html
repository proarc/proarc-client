<div fxLayout="column" fxFlexFill>
  <div fxLayout="row" fxLayoutAlign="start center" class="app-breadcrumbsbar">
    <div fxLayout="row" fxLayoutAlign="start center" class="app-breadcrumbs">
      <a routerLink="/"><mat-icon>home</mat-icon> Home</a>
      <span class="app-separator">/</span>
      <span class="app-last">{{ 'search.title' | translate }}</span>
    </div>
    <button mat-button value="phrase"  [class.app-active]="searchMode === 'phrase'" (click)="searchMode = 'phrase'">{{ 'button.query' | translate }}</button>
    <button mat-button value="advanced" [class.app-active]="searchMode === 'advanced'" (click)="searchMode = 'advanced'">{{ 'button.advancedSearch' | translate }}</button>
    <button mat-button value="deleted" [class.app-active]="searchMode === 'deleted'" (click)="searchMode = 'deleted'">{{ 'button.searchInDeleted' | translate }}</button>
  </div>

  <mat-progress-bar mode="indeterminate" *ngIf="state=='loading'" class="app-progress-bar"></mat-progress-bar>

  <div *ngIf="state!=='loading'" fxFlex class="app-search-results" fxLayout="column">
    <div class="app-formbar" fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start baseline">
      <button mat-flat-button color="primary" (click)="filter()">
        {{ 'button.search' | translate }}
      </button>
      <ng-container *ngIf="searchMode === 'phrase'">
        <mat-form-field>
          <mat-select #modelSelect [placeholder]="'desc.model' | translate" name="model" [(ngModel)]="model" (keyup.enter)="enterModel(modelSelect)">
            <mat-option value="all">{{ 'desc.all' | translate }}</mat-option>
            <mat-option *ngFor="let model of models" [value]="model">{{ "model." + model | translate }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field fxFlex>
          <input matInput [placeholder]="'desc.search' | translate" (keyup.enter)="filter()" [(ngModel)]="query">
        </mat-form-field>
      </ng-container>
      <ng-container *ngIf="searchMode !== 'phrase'">
        <mat-form-field>
          <mat-select [placeholder]="'desc.model' | translate" name="model" [(ngModel)]="model">
            <mat-option value="all">{{ 'desc.all' | translate }}</mat-option>
            <mat-option *ngFor="let model of models" [value]="model">{{ "model." + model | translate }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field fxFlex>
          <input matInput [placeholder]="'desc.name' | translate" (keyup.enter)="filter()" [(ngModel)]="queryLabel">
        </mat-form-field>
        <mat-form-field fxFlex>
          <input matInput [placeholder]="'desc.identifier' | translate" (keyup.enter)="filter()" [(ngModel)]="queryIdentifier">
        </mat-form-field>
        <mat-form-field fxFlex>
          <input matInput [placeholder]="'desc.creator' | translate" (keyup.enter)="filter()" [(ngModel)]="queryCreator">
        </mat-form-field>
        <mat-form-field>
          <mat-select [placeholder]="'desc.organization' | translate" name="organization" [(value)]="organization">
            <mat-option value="-">{{ 'desc.all' | translate }}</mat-option>
            <mat-option *ngFor="let org of organizations" [value]="org">{{ 'organization.' + org | translate }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="app-owner">
          <mat-select [placeholder]="'desc.owner' | translate" name="owner" [(value)]="owner">
            <mat-option value="-">{{ 'desc.all' | translate }}</mat-option>
            <mat-option *ngFor="let user of users" [value]="user.name">{{ user.name }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="app-processor">
          <mat-select [placeholder]="'desc.processor' | translate" name="processor" [(value)]="processor">
            <mat-option value="-">{{ 'desc.all' | translate }}</mat-option>
            <mat-option *ngFor="let user of users" [value]="user.name">{{ user.name }}</mat-option>
          </mat-select>
        </mat-form-field>
      </ng-container>
    </div>

    <as-split fxFlex unit="percent" [gutterSize]="10" direction="vertical" (dragEnd)="dragEnd($event)" #split="asSplit">
      <as-split-area #area1="asSplitArea" [minSize]="20" [size]="getSplitSize(0)">
        <div *ngIf="items" fxLayout="column" fxFlexFill>
          <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start center" class="app-toolbar app-toolbar-action app-view-border-bottom">
            <div fxFlex *ngIf="selectedItem" fxLayout="row" fxFlexFill>
              <button mat-icon-button [matMenuTriggerFor]="columns_menu" [matTooltip]="'button.columnSelection' | translate" >
                <mat-icon>rule</mat-icon>
              </button>
              <mat-menu #columns_menu="matMenu">
                <div *ngFor="let column of selectedColumns" mat-menu-item>
                  <mat-checkbox name="column.field" [(ngModel)]="column.selected" (change)="setSelectedColumns()">{{ 'search.' + column.field | translate }}</mat-checkbox>
                </div>
              </mat-menu>
              <button (click)="reload()" mat-button>{{'button.refresh' | translate }}</button>
              <button (click)="openItem(selectedItem)" mat-button>{{ 'button.open' | translate }}</button>
              <button (click)="showFoxml(selectedItem)" mat-button>FOXML</button>
              <button (click)="onExport(selectedItem)" mat-button>{{ 'button.export' | translate }}</button>
              <button (click)="onUrnnbn(selectedItem)" mat-button>URN:NBN</button>
              <button *ngIf="canChangeModel(selectedItem)" (click)="changeModel(selectedItem)" mat-button>{{ 'button.conversionsOfModels' | translate }}</button>
              <button (click)="onDeleteItem()" mat-button>{{ 'button.delete' | translate }}</button>
              <button *ngIf="!selectedItem.isLocked && (auth.user.lockObjectFunction || auth.isSuperAdmin())" (click)="onLock(selectedItem, true)" mat-button>{{ 'button.lockIt' | translate }}</button>
              <button *ngIf="selectedItem.isLocked && (auth.user.unlockObjectFunction || auth.isSuperAdmin())" (click)="onLock(selectedItem, false)" mat-button>{{ 'button.unlock' | translate }}</button>
              <button *ngIf="selectedItem.state === 'fedora-system:def/model#Deleted'" (click)="onRestore(selectedItem)" mat-button>{{ 'button.restoreTheObject' | translate }}</button>
              <button (click)="updateObjects(selectedItem)" mat-button>{{ 'button.updateAllObjects' | translate }}</button>
            </div>
            <div>
              <mat-paginator [length]="resultCount" hidePageSize="true" [pageIndex]="pageIndex" [pageSize]="pageSize" (page)="onPageChanged($event)"></mat-paginator>
            </div>
          </div>
          <div class="app-oa-y">
            <table mat-table #table [dataSource]="items" matSort class="app-striped app-hover" (matSortChange)="sortTable($event)">
              <ng-container matColumnDef="label">
                <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by number">{{ 'desc.name' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="element.label">
                    <div class="app-text-cutter">
                      {{ element.label }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="model">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.model' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="'model.' + element.model | translate">
                    <div class="app-text-cutter">
                      {{ "model." + element.model | translate }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="pid">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.pid' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="element.pid">
                    <div class="app-text-cutter">
                      {{ element.pid }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="processor">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.processor' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="element.processor">
                    <div class="app-text-cutter">
                      {{ element.processor }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="organization">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.organization' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="'organization.' + element.organization | translate">
                    <div class="app-text-cutter">
                      {{ 'organization.' + element.organization | translate }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.status' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="'editor.atm.statuses.' + element.status | translate">
                    <div class="app-text-cutter">
                      {{ 'editor.atm.statuses.' + element.status | translate }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="created">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.created' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="element.created | appDatetime">
                    <div class="app-text-cutter">
                      {{ element.created | appDatetime }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="modified">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.modified' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="element.modified | appDatetime">
                    <div class="app-text-cutter">
                      {{ element.modified | appDatetime }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="owner">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'desc.owner' | translate }}</th>
                <td mat-cell *matCellDef="let element">
                  <div class="app-text-cutter-wrapper" [matTooltip]="element.owner">
                    <div class="app-text-cutter">
                      {{ element.owner }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="export">
                <th mat-header-cell *matHeaderCellDef>{{ 'desc.export' | translate }}</th>
                <td mat-cell *matCellDef="let element">{{ element.writeExports() }}</td>
              </ng-container>

              <ng-container matColumnDef="isLocked">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon [matTooltip]="element.isLocked ? ('desc.locked' | translate) : ('desc.unlocked' | translate)">{{ element.isLocked ? 'lock' : 'lock_open' }}</mat-icon>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selectItem(row)" (dblclick)="openItem(row)" class="app-cursor-pointer" [class.app-selected]="row == selectedItem"></tr>
            </table>
          </div>
        </div>
      </as-split-area>

      <as-split-area #area2="asSplitArea" [minSize]="20" [size]="getSplitSize(1)">
        <div *ngIf="tree" fxLayout="column" fxFlexFill>
          <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start center" class="app-toolbar app-toolbar-action app-view-border-bottom">
            <div fxFlex *ngIf="search.selectedTree" fxLayout="row" fxFlexFill>
              <button (click)="selectItem(selectedItem)" mat-button>{{'button.refresh' | translate }}</button>
              <button (click)="openItem(search.selectedTree.item)" mat-button>{{ 'button.open' | translate }}</button>
              <button (click)="showFoxml(search.selectedTree.item)" mat-button>FOXML</button>
              <button (click)="onExport(search.selectedTree.item)" mat-button>{{ 'button.export' | translate }}</button>
              <button (click)="onUrnnbn(search.selectedTree.item)" mat-button>URN:NBN</button>
              <button *ngIf="canChangeModel(search.selectedTree.item)" (click)="changeModel(search.selectedTree.item)" mat-button>{{ 'button.conversionsOfModels' | translate }}</button>
              <button (click)="onExpandAll()" mat-button>{{ 'button.unpack' | translate }}</button>
              <button *ngIf="search.selectedTree.item" (click)="onDeleteFromTree()" mat-button>{{ 'button.delete' | translate }}</button>
              <button *ngIf="canCopy(search.selectedTree.item)" (click)="onCopyItem(search.selectedTree.item)" mat-button>{{ 'button.copy' | translate }}</button>
              <button *ngIf="!search.selectedTree.item.isLocked && (auth.user.lockObjectFunction  || auth.isSuperAdmin())" (click)="onLock(search.selectedTree.item, true)" mat-button>{{ 'button.lockIt' | translate }}</button>
              <button *ngIf="search.selectedTree.item.isLocked && (auth.user.unlockObjectFunction || auth.isSuperAdmin())" (click)="onLock(search.selectedTree.item, false)" mat-button>{{ 'button.unlock' | translate }}</button>
              <button (click)="updateObjects(search.selectedTree.item)" mat-button>{{ 'button.updateAllObjects' | translate }}</button>
            </div>
          </div>
          <div fxFlex class="app-oh app-tree">
              <div class="app-row app-header" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="4px">
                <div [style.width]="(tree.level * 20 + 30) + 'px'"></div>
                <div class="app-cell-first" [fxFlex]="(300 - tree.level * 20) + 'px'" *ngIf="properties.isSearchColEnabled('name')">{{ 'desc.name' | translate }}</div>
                <div fxFlex class="app-cell app-model" *ngIf="properties.isSearchColEnabled('model')">{{ 'desc.model' | translate }}</div>
                <div fxFlex class="app-cell app-pid" *ngIf="properties.isSearchColEnabled('pid')">PID</div>
                <div fxFlex class="app-cell app-processor" *ngIf="properties.isSearchColEnabled('processor')">{{ 'desc.processor' | translate }}</div>
                <div fxFlex class="app-cell app-organization" *ngIf="properties.isSearchColEnabled('organization')">{{ 'desc.organization' | translate }}</div>
                <div fxFlex class="app-cell app-status" *ngIf="properties.isSearchColEnabled('status')">{{ 'desc.status' | translate }}</div>
                <div fxFlex class="app-cell app-created" *ngIf="properties.isSearchColEnabled('created')">{{ 'desc.created' | translate }}</div>
                <div fxFlex class="app-cell app-modified" *ngIf="properties.isSearchColEnabled('modified')">{{ 'desc.modified' | translate }}</div>
                <div fxFlex class="app-cell app-owner" *ngIf="properties.isSearchColEnabled('owner')">{{ 'desc.owner' | translate }}</div>
                <div fxFlex class="app-cell app-export" *ngIf="properties.isSearchColEnabled('export')">{{ 'desc.export' | translate }}</div>
                <div fxFlex class="app-cell app-isLocked"></div>
              </div>
              <div class="app-body-height app-oa-y">
                <app-tree [tree]="tree" (onOpen)="openFromTree($event)" (onSelect)="selectFromTree($event)"></app-tree>
              </div>
          </div>
        </div>
      </as-split-area>
    </as-split>
  </div>
</div>
