<ng-container *ngIf="isReady">

  <!-- <app-tree [tree]="layout.tree" [inPanel]="true" 
  [selectedPid]="selectedPid" [selectedParentPid]="selectedParentPid"
  (onOpen)="openFromTree($event)" (onSelect)="selectFromTree($event)" 
  [expanded]="true" [expandedPath]="[]"></app-tree> -->


  <ng-container *ngTemplateOutlet="rowTmpl; context:{ tree: layout.tree }"></ng-container>

  <ng-template #rowTmpl let-tree="tree">

    <div (click)="select(tree)" (dblclick)="open(tree)" class="app-row"
      [class.app-parent]="tree.item.pid === selectedParentPid"
      [class.app-active-tree]="(tree.item.selected  || tree.item.pid == selectedPid)">
      <div class="app-expansion-cell">
        <div class="app-expansion-icon" [style.width]="(tree.level * 20 + 40) + 'px'">
          <mat-spinner *ngIf="tree.loading" [strokeWidth]="3" [diameter]="20">
          </mat-spinner>
          <mat-icon class="app-tree-expand" *ngIf="tree.expandable() && !tree.loading" (click)="toggle($event, tree)">{{
            tree.expanded ? "expand_more" : "chevron_right" }}</mat-icon>
          <span class="app-tree-expand" *ngIf="!tree.expandable() && !tree.loading" style="width: 36px;">&#160;</span>
        </div>
        <div>{{ tree.item.label }}</div>
      </div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('model')">{{ "model." + tree.item.model | translate
        }}</div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('processor')">{{ tree.item.processor }}</div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('organization')">{{ 'organization.' +
        tree.item.organization | translate }}</div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('status')">{{ 'editor.atm.statuses.' +
        tree.item.status | translate }}</div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('created')">{{ tree.item.created | appDatetime }}
      </div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('modified')">{{ tree.item.modified | appDatetime
        }}</div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('owner')">{{ tree.item.owner }}</div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('export')">{{ tree.item.writeExports() }}</div>
      <div class="app-cell" *ngIf="properties.isSearchColEnabled('isLocked')">{{ (tree.item.isLocked ? 'common.yes'
        :
        'common.no') | translate }}</div>
    </div>
    <ng-container *ngIf="tree.expanded && tree.children">
      <ng-container *ngFor="let child of tree.children">

        <ng-container *ngTemplateOutlet="rowTmpl; context:{ tree: child }"></ng-container>
      </ng-container>
    </ng-container>

  </ng-template>