<div style="position: relative; top: 0px;z-index: 200;">
  @if (loadingTree) {
    <mat-progress-bar mode="indeterminate" class="app-progress-bar" style="position: absolute; top: 0px;"></mat-progress-bar>
  }
</div>

<table mat-table [dataSource]="visibleTreeItems" class="app-striped app-hover app-resize" matSort #treeTable>
  @for(c of treeColumns; let idx = $index; let last = $last; track $index;) {
    <ng-container [matColumnDef]="c">
      <th mat-header-cell *matHeaderCellDef [resizeColumn]="true" (columnResized)="saveTreeColumnsSizes($event,c)" [style.width]="treeColumnsSizes[c]">
        @if (c !== 'isLocked') {
          <span>{{'search.' + c | translate}}</span>
        }
        @if (last) {
          <button (click)="setColumns()" mat-icon-button [matTooltip]="'editor.children.select_columns' | translate" color="primary">
            <mat-icon>more_vert</mat-icon>
          </button>
        }
      </th>
      <td mat-cell *matCellDef="let element">
        @if (idx === 0) {
          <span [style.margin-left]="(element.level * 15) + 'px'">
            @if (element.expandable || true) {
              <mat-icon (click)="toggleTree($event, element)">{{ element.expanded ? "expand_more" : "chevron_right" }}</mat-icon>
            }
          </span>
        }
        @switch (columnTypes[c]) {
          @case ('date') {
            {{ element[c] | date : 'dd.MM.yyyy hh:mm:ss'}}
          }
          @case ('list') {
            {{ listValue(c, element[c])}}
          }
          @case ('translated') {
            {{ prefixes[c] + element[c] | translate }}
          }
          @case ('boolean') {
            <span class="app-pl-1 app-lr-2">
              <mat-icon [matTooltip]="element.isLocked ? ('desc.locked' | translate) : ('desc.unlocked' | translate)">{{ element.isLocked ? 'lock' : 'lock_open' }}</mat-icon>
            </span>
          }
          @default {
            @if (c === 'pid') {
              <a class="app-icon-copy app-mr-1" (click)="ui.copyTextToClipboard(element.pid)" [matTooltip]="'button.copyTextToClipboard' | translate">
                <mat-icon class="app-icon-copy">content_copy</mat-icon>
              </a>
            }
            {{ element[c] }}
          }
        }
      </td>
    </ng-container>
  }
  <tr mat-header-row *matHeaderRowDef="treeColumns; sticky: true"></tr>
  <tr mat-row *matRowDef="let row; columns: treeColumns; let idx = index" (dblclick)="openTreeItem($event, row)" (click)="selectTreeItem($event, row, idx)" [class.app-selected]="row.selected"></tr>
</table>